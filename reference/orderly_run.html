<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Run a report — orderly_run • orderly</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Run a report — orderly_run" />
<meta property="og:description" content="Run a report.  This will create a new directory in
drafts/&amp;lt;reportname&amp;gt;, copy your declared resources there,
extract data from databases (if you are using them), run your
script and check that all expected artefacts were created.  Once
successfully run you can use orderly_commit to move
it to the archive directory." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orderly</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/orderly.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/changelog.html">orderly changelog</a>
    </li>
    <li>
      <a href="../articles/remote.html">orderly remotes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/vimc/orderly/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run a report</h1>
    <small class="dont-index">Source: <a href='https://github.com/vimc/orderly/blob/master/R/recipe_run.R'><code>R/recipe_run.R</code></a></small>
    <div class="hidden name"><code>orderly_run.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Run a report.  This will create a new directory in
<code>drafts/&lt;reportname&gt;</code>, copy your declared resources there,
extract data from databases (if you are using them), run your
script and check that all expected artefacts were created.  Once
successfully run you can use <code><a href='orderly_commit.html'>orderly_commit</a></code> to move
it to the <code>archive</code> directory.</p>
    </div>

    <pre class="usage"><span class='fu'>orderly_run</span>(
  <span class='kw'>name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>parameters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>envir</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>root</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>locate</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>echo</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>id_file</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>fetch</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>ref</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>message</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>instance</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>use_draft</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>remote</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>tags</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>batch_id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>name</th>
      <td><p>Name of the report to run (see
<code><a href='orderly_list.html'>orderly_list</a></code>).  A leading <code>src/</code> will be
removed if provided, allowing easier use of autocomplete.
Alternatively, the default of <code>NULL</code> is useful if you have
already set the working directory to be the source directory.</p></td>
    </tr>
    <tr>
      <th>parameters</th>
      <td><p>Parameters passed to the report. A named list of
parameters declared in the <code>orderly.yml</code>.  Each parameter
must be a scalar character, numeric, integer or logical.</p></td>
    </tr>
    <tr>
      <th>envir</th>
      <td><p>The parent of the environment that will be used to
evaluate the report script; by default a new environment will be
made with the global environment as the parent.</p></td>
    </tr>
    <tr>
      <th>root</th>
      <td><p>The path to an orderly root directory, or <code>NULL</code>
(the default) to search for one from the current working
directory if <code>locate</code> is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>locate</th>
      <td><p>Logical, indicating if the configuration should be
searched for.  If <code>TRUE</code> and <code>config</code> is not given,
then orderly looks in the working directory and up through its
parents until it finds an <code>orderly_config.yml</code> file.</p></td>
    </tr>
    <tr>
      <th>echo</th>
      <td><p>Print the result of running the R code to the console</p></td>
    </tr>
    <tr>
      <th>id_file</th>
      <td><p>Write the identifier into a file</p></td>
    </tr>
    <tr>
      <th>fetch</th>
      <td><p>Logical, indicating if git should be fetched before
checking out the reference <code>ref</code>.</p></td>
    </tr>
    <tr>
      <th>ref</th>
      <td><p>A git reference to use for this run (see Details)</p></td>
    </tr>
    <tr>
      <th>message</th>
      <td><p>An optional character string containing a message
explaining why the report was run</p></td>
    </tr>
    <tr>
      <th>instance</th>
      <td><p>Select instance of the source database to be used,
where multiple instances are configured.  Use a single
<em>unnamed</em> character string to indicate an instance to
match.  If given, then this name must be present in all
databases where instances are listed in
<code>orderly_config.yml</code>, and will be ignored by all database
where instances are not given.  See the "orderly" vignette for
further information.</p></td>
    </tr>
    <tr>
      <th>use_draft</th>
      <td><p>Should draft reports be used for dependencies?
This should be used only in development.  Valid values are
logical (<code>TRUE</code>, <code>FALSE</code>) or use the string
<code>newer</code> to use draft reports where they are newer than
archive reports.  For consistency, <code>always</code> and
<code>never</code> are equivalent to <code>TRUE</code> and <code>FALSE</code>,
respectively.</p></td>
    </tr>
    <tr>
      <th>remote</th>
      <td><p>Remote to use to resolve dependencies.  Use this in
order to run a report with the same dependencies as are
available on a remote server, particularly when using <code>id =
"latest"</code>.  Note that this is not the same as running
<code><a href='orderly_pull_dependencies.html'>orderly_pull_dependencies</a></code>, then <code>orderly_run</code>
with <code>remote = NULL</code>, as the pull/run approach will use the
latest report in <em>your</em> archive but the <code>remote =
"remote"</code> approach will use the latest approach in the
<em>remote</em> archive (which might be less recent).</p></td>
    </tr>
    <tr>
      <th>tags</th>
      <td><p>Character vector of tags to add to the report.  Tags
are immutable and cannot be removed once the report is run.
Tags added here will be <em>in addition</em> to any tags listed in
the <code>tags:</code> field in <code>orderly.yml</code> and must be present
in <code>orderly_config.yml</code>.</p></td>
    </tr>
    <tr>
      <th>batch_id</th>
      <td><p>ID of batch report run created by
<code><a href='orderly_batch.html'>orderly_batch</a></code>. Gets written into <code>orderly_run.rds</code> as
metadata, not expected to be passed by user.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The id of the newly created report</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If <code>ref</code> is provided then before running a report orderly
will try to check out (as a detached <code>HEAD</code>) <code>ref</code>,
interpreted as a git reference.  This can be a commit, tag, or a
branch name (including remote).  The working directory must be
clean according to <code>git status</code> and this <em>will</em> require
some careful use of <code>.gitignore</code> to exclude <code>draft</code>,
<code>archive</code>, <code>data</code> and <code>orderly.sqlite</code> (see
<code><a href='orderly_use.html'>orderly_use_gitignore</a></code> to help automate this).  The
git tree will revert back to the original branch at completion (or
failure to complete) the report.</p>
<p>Parameters are passed to the report as a named list, for example</p>
<p><code>
id &lt;- orderly::orderly_run("other", list(nmin = 0.2), root = path)
</code></p>
<p>(see the examples).  The names of the parameters (here,
<code>nmin</code>) must correspond to declared parameters in the
<code>orderly.yml</code>.  It is an error if parameters without a
default are omitted, and it is an error if unknown parameters are
provided.</p>
<p>Environment variables that are created in <code>orderly_envir.yml</code>
will be available while the report runs.  Those that begin with
<code>ORDERLY_</code> will be saved into the <code>orderly_run.rds</code>
within the <code>$env</code> section (except for any that match the
patterns "TOKEN", "PAT" or "PASS").</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='orderly_log.html'>orderly_log</a></code> for controlling display of log
  messages (not just R output)</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>path</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'><a href='orderly_example.html'>orderly_example</a></span>(<span class='st'>"demo"</span>)

<span class='co'># To run most reports, provide the report name (and the path if</span>
<span class='co'># not running in the working directory, as is the case here):</span>
<span class='no'>id</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_run</span>(<span class='st'>"minimal"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>path</span>)</div><div class='output co'>#&gt; <span class='message'>[ name       ]  minimal</span></div><div class='output co'>#&gt; <span class='message'>[ id         ]  20200403-103546-a458b29f</span></div><div class='output co'>#&gt; <span class='message'>[ data       ]  source =&gt; dat: 20 x 2</span></div><div class='output co'>#&gt; <span class='message'>[ start      ]  2020-04-03 10:35:46</span></div><div class='output co'>#&gt; 
#&gt; &gt; png("mygraph.png")
#&gt; 
#&gt; &gt; par(mar = c(15, 4, 0.5, 0.5))
#&gt; 
#&gt; &gt; barplot(setNames(dat$number, dat$name), las = 2)</div><div class='output co'>#&gt; 
#&gt; &gt; dev.off()
#&gt; pdf 
#&gt;   2 </div><div class='output co'>#&gt; <span class='message'>[ end        ]  2020-04-03 10:35:46</span></div><div class='output co'>#&gt; <span class='message'>[ elapsed    ]  Ran report in 0.01146054 secs</span></div><div class='output co'>#&gt; <span class='message'>[ artefact   ]  mygraph.png: 5f8e1c71677703144642256f70c86502</span></div><div class='input'>
<span class='co'># Every report gets a unique identifier, based on the time (it is</span>
<span class='co'># ISO 8601 time with random hex appended to end)</span>
<span class='no'>id</span></div><div class='output co'>#&gt; [1] "20200403-103546-a458b29f"</div><div class='input'>
<span class='co'># After being run, a report is a "draft" and will exist in the</span>
<span class='co'># drafts directory:</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'><a href='orderly_list_drafts.html'>orderly_list_drafts</a></span>(<span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>path</span>)</div><div class='output co'>#&gt;      name                       id
#&gt; 1 minimal 20200403-103546-a458b29f</div><div class='input'>
<span class='co'># Draft reports are always stored in the path</span>
<span class='co'># &lt;root&gt;/draft/&lt;name&gt;/&lt;id&gt;, so we have</span>
<span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>dir</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>path</span>, <span class='st'>"draft"</span>, <span class='st'>"minimal"</span>, <span class='no'>id</span>))</div><div class='output co'>#&gt; [1] "mygraph.png"     "orderly_run.rds" "orderly.yml"     "script.R"       </div><div class='input'>
<span class='co'># which contains the files when the report was run.</span>

<span class='co'># If a report has parameters, then these must be passed in as a</span>
<span class='co'># named list.</span>
<span class='no'>id</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_run</span>(<span class='st'>"other"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>nmin</span> <span class='kw'>=</span> <span class='fl'>0.2</span>), <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>path</span>)</div><div class='output co'>#&gt; <span class='message'>[ name       ]  other</span></div><div class='output co'>#&gt; <span class='message'>[ id         ]  20200403-103546-b6dc0071</span></div><div class='output co'>#&gt; <span class='message'>[ sources    ]  functions.R</span></div><div class='output co'>#&gt; <span class='message'>[ parameter  ]  nmin: 0.2</span></div><div class='output co'>#&gt; <span class='message'>[ data       ]  source =&gt; extract: 19 x 2</span></div><div class='output co'>#&gt; <span class='message'>[ start      ]  2020-04-03 10:35:46</span></div><div class='output co'>#&gt; 
#&gt; &gt; extract$number &lt;- extract$number + rnorm(1)
#&gt; 
#&gt; &gt; write.csv(extract, "summary.csv", row.names = TRUE)
#&gt; 
#&gt; &gt; png("graph.png")
#&gt; 
#&gt; &gt; par(mar = c(15, 4, 0.5, 0.5))
#&gt; 
#&gt; &gt; do_plot(extract)</div><div class='output co'>#&gt; 
#&gt; &gt; dev.off()
#&gt; pdf 
#&gt;   2 </div><div class='output co'>#&gt; <span class='message'>[ end        ]  2020-04-03 10:35:46</span></div><div class='output co'>#&gt; <span class='message'>[ elapsed    ]  Ran report in 0.01233864 secs</span></div><div class='output co'>#&gt; <span class='message'>[ artefact   ]  summary.csv: da1bdb89343fc0c1c9b19f3d257d27f7</span>
#&gt; <span class='message'>[ ...        ]  graph.png: 0f5857002852d4d85f0d3423907eeb2c</span></div><div class='input'>
# These parameters can be used in SQL queries or in the report
# code.
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill, Martin Eden, Wes Hinsley, Emma Russell, James Thompson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


