<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Deduplicate an orderly archive — orderly_deduplicate • orderly</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Deduplicate an orderly archive — orderly_deduplicate" />
<meta property="og:description" content="Deduplicate an orderly archive.  Deduplicating an orderly archive
will replace all files that have the same content with &quot;hard
links&quot;.  This requires hard link support in the underlying
operating system, which is available on all unix-like systems
(e.g. MacOS and Linux) and on Windows since Vista.  However, on
windows systems this might require somewhat elevated privileges.
If you use this feature, it is very important that you
treat your orderly archive as read-only (though you should be
anyway) as changing one copy of a linked file changes all the
other instances of it - the files are literally the same file." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orderly</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/orderly.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/changelog.html">orderly changelog</a>
    </li>
    <li>
      <a href="../articles/remote.html">orderly remotes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/vimc/orderly/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Deduplicate an orderly archive</h1>
    <small class="dont-index">Source: <a href='https://github.com/vimc/orderly/blob/master/R/deduplicate.R'><code>R/deduplicate.R</code></a></small>
    <div class="hidden name"><code>orderly_deduplicate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Deduplicate an orderly archive.  Deduplicating an orderly archive
will replace all files that have the same content with "hard
links".  This requires hard link support in the underlying
operating system, which is available on all unix-like systems
(e.g. MacOS and Linux) and on Windows since Vista.  However, on
windows systems this might require somewhat elevated privileges.
If you use this feature, it is <em>very important</em> that you
treat your orderly archive as read-only (though you should be
anyway) as changing one copy of a linked file changes all the
other instances of it - the files are literally the same file.</p>
    </div>

    <pre class="usage"><span class='fu'>orderly_deduplicate</span>(<span class='kw'>root</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>locate</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>dry_run</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>quiet</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>root</th>
      <td><p>The path to an orderly root directory, or <code>NULL</code>
(the default) to search for one from the current working
directory if <code>locate</code> is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>locate</th>
      <td><p>Logical, indicating if the configuration should be
searched for.  If <code>TRUE</code> and <code>config</code> is not given,
then orderly looks in the working directory and up through its
parents until it finds an <code>orderly_config.yml</code> file.</p></td>
    </tr>
    <tr>
      <th>dry_run</th>
      <td><p>Logical, indicating if the deduplication should be
planned but not run</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>Logical, indicating if the status should not be printed</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Invisibly, information about the duplication status of the
  archive before deduplication was run.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function will alter your orderly archive.  Ordinarily this is
not something that should be done, so we try to be careful.  In
order for this to work, it is <em>very important</em> to treat your
orderly archive as read-only generally.  If your canonical orderly
archive is behind OrderlyWeb this will almost certainly be the
case already.</p>
<p>With "hard linking", two files with the same content can be
updated so that both files point at the same physical bit of data
(see <a href='https://en.wikipedia.org/wiki/Hard_link'>this Wikipedia
page for more information</a>).  This is great, as if the file is
large, then only one copy needs to be stored.  However, this means
that if a change is made to one copy of the file, it is
immediately reflected in the other, but there is nothing to
indicate that the files are linked!</p>
<p>This approach is worth exploring if you have large files that are
outputs of one report and inputs to another, or large inputs
repeatedly used in different reports, or outputs that end up being
the same in multiple reports.  If you run the deduplication with
<code>dry_run = TRUE</code>, an indication of the savings will be
printed.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='no'>path</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'><a href='orderly_example.html'>orderly_example</a></span>(<span class='st'>"demo"</span>)
<span class='no'>id1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'><a href='orderly_run.html'>orderly_run</a></span>(<span class='st'>"minimal"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>path</span>)</div><div class='output co'>#&gt; <span class='message'>[ name       ]  minimal</span></div><div class='output co'>#&gt; <span class='message'>[ id         ]  20200403-103537-fe88a920</span></div><div class='output co'>#&gt; <span class='message'>[ data       ]  source =&gt; dat: 20 x 2</span></div><div class='output co'>#&gt; <span class='message'>[ start      ]  2020-04-03 10:35:38</span></div><div class='output co'>#&gt; 
#&gt; &gt; png("mygraph.png")
#&gt; 
#&gt; &gt; par(mar = c(15, 4, 0.5, 0.5))
#&gt; 
#&gt; &gt; barplot(setNames(dat$number, dat$name), las = 2)</div><div class='output co'>#&gt; 
#&gt; &gt; dev.off()
#&gt; pdf 
#&gt;   2 </div><div class='output co'>#&gt; <span class='message'>[ end        ]  2020-04-03 10:35:38</span></div><div class='output co'>#&gt; <span class='message'>[ elapsed    ]  Ran report in 0.0216279 secs</span></div><div class='output co'>#&gt; <span class='message'>[ artefact   ]  mygraph.png: 5f8e1c71677703144642256f70c86502</span></div><div class='input'><span class='no'>id2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'><a href='orderly_run.html'>orderly_run</a></span>(<span class='st'>"minimal"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>path</span>)</div><div class='output co'>#&gt; <span class='message'>[ name       ]  minimal</span></div><div class='output co'>#&gt; <span class='message'>[ id         ]  20200403-103538-18e03056</span></div><div class='output co'>#&gt; <span class='message'>[ data       ]  source =&gt; dat: 20 x 2</span></div><div class='output co'>#&gt; <span class='message'>[ start      ]  2020-04-03 10:35:38</span></div><div class='output co'>#&gt; 
#&gt; &gt; png("mygraph.png")
#&gt; 
#&gt; &gt; par(mar = c(15, 4, 0.5, 0.5))
#&gt; 
#&gt; &gt; barplot(setNames(dat$number, dat$name), las = 2)</div><div class='output co'>#&gt; 
#&gt; &gt; dev.off()
#&gt; pdf 
#&gt;   2 </div><div class='output co'>#&gt; <span class='message'>[ end        ]  2020-04-03 10:35:38</span></div><div class='output co'>#&gt; <span class='message'>[ elapsed    ]  Ran report in 0.01543093 secs</span></div><div class='output co'>#&gt; <span class='message'>[ artefact   ]  mygraph.png: 5f8e1c71677703144642256f70c86502</span></div><div class='input'><span class='fu'><a href='orderly_commit.html'>orderly_commit</a></span>(<span class='no'>id1</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>path</span>)</div><div class='output co'>#&gt; <span class='message'>[ commit     ]  minimal/20200403-103537-fe88a920</span></div><div class='output co'>#&gt; <span class='message'>[ copy       ]</span></div><div class='output co'>#&gt; <span class='message'>[ import     ]  minimal:20200403-103537-fe88a920</span></div><div class='output co'>#&gt; <span class='message'>[ success    ]  :)</span></div><div class='output co'>#&gt; [1] "/tmp/Rtmp9iZLVY/file3d3e682972/archive/minimal/20200403-103537-fe88a920"</div><div class='input'><span class='fu'><a href='orderly_commit.html'>orderly_commit</a></span>(<span class='no'>id2</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>path</span>)</div><div class='output co'>#&gt; <span class='message'>[ commit     ]  minimal/20200403-103538-18e03056</span></div><div class='output co'>#&gt; <span class='message'>[ copy       ]</span></div><div class='output co'>#&gt; <span class='message'>[ import     ]  minimal:20200403-103538-18e03056</span></div><div class='output co'>#&gt; <span class='message'>[ success    ]  :)</span></div><div class='output co'>#&gt; [1] "/tmp/Rtmp9iZLVY/file3d3e682972/archive/minimal/20200403-103538-18e03056"</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/conditions.html'>tryCatch</a></span>(
  <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_deduplicate</span>(<span class='no'>path</span>, <span class='kw'>dry_run</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>),
  <span class='kw'>error</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>e</span>) <span class='kw'>NULL</span>)</div><div class='output co'>#&gt; Deduplication information for
#&gt;   /tmp/Rtmp9iZLVY/file3d3e682972/archive
#&gt;   - 6 tracked files
#&gt;   - 20.42 kB total size
#&gt;   - 3 duplicate files
#&gt;   - 10.21 kB duplicated size
#&gt;   - 0 deduplicated files
#&gt;   - 0 B deduplicated size
#&gt;   - 0 untracked files
#&gt;   - 0 B untracked size</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill, Martin Eden, Wes Hinsley, Emma Russell, James Thompson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


