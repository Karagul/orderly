<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Search for orderly reports matching criteria — orderly_search • orderly</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Search for orderly reports matching criteria — orderly_search" />
<meta property="og:description" content="Search for orderly reports matching criteria.  This can be used to
find reports where a particular parameter or tag was used (it will
likely be expanded as time goes on - let us know if that would be
useful).  We search within versions of a single report only." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orderly</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/orderly.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/changelog.html">orderly changelog</a>
    </li>
    <li>
      <a href="../articles/remote.html">orderly remotes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/vimc/orderly/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Search for orderly reports matching criteria</h1>
    <small class="dont-index">Source: <a href='https://github.com/vimc/orderly/blob/master/R/query_search.R'><code>R/query_search.R</code></a></small>
    <div class="hidden name"><code>orderly_search.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Search for orderly reports matching criteria.  This can be used to
find reports where a particular parameter or tag was used (it will
likely be expanded as time goes on - let us know if that would be
useful).  We search within versions of a single report only.</p>
    </div>

    <pre class="usage"><span class='fu'>orderly_search</span>(
  <span class='no'>query</span>,
  <span class='no'>name</span>,
  <span class='kw'>parameters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>draft</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>root</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>locate</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>query</th>
      <td><p>The query string - see details and examples</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>Name of the report to search.  Only a single report
can be searched at once.</p></td>
    </tr>
    <tr>
      <th>parameters</th>
      <td><p>Named list of parameters (as would be passed to
<code><a href='orderly_run.html'>orderly_run</a></code>) if your query uses parameters on the
right-hand-side of an expression.</p></td>
    </tr>
    <tr>
      <th>draft</th>
      <td><p>Should draft reports be used searched?  This should
be used only in development.  Valid values are logical
(<code>TRUE</code>, <code>FALSE</code>) or use the string <code>newer</code> to
use draft reports where they are newer than archive reports.
For consistency, <code>always</code> and <code>never</code> are equivalent
to <code>TRUE</code> and <code>FALSE</code>, respectively.</p></td>
    </tr>
    <tr>
      <th>root</th>
      <td><p>The path to an orderly root directory, or <code>NULL</code>
(the default) to search for one from the current working
directory if <code>locate</code> is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>locate</th>
      <td><p>Logical, indicating if the configuration should be
searched for.  If <code>TRUE</code> and <code>config</code> is not given,
then orderly looks in the working directory and up through its
parents until it finds an <code>orderly_config.yml</code> file.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A character vector of matching report ids, possibly
  zero-length.  If the query is a "latest" query, then exactly one
  report id, possibly NA.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The query syntax is deliberately very simple; it may expand a bit
later.  At this point you can search for parameters and for tags,
and these can be combined.  Note that if you are using OrderlyWeb,
then only orderly (and not OrderlyWeb) tags are searched.</p>
<p>The idea here is that the queries can be used to find ids that
match certain criteria for use as dependencies.  This function
lets you work out what would be resolved by the query, and using
this query string in a <code>depends:</code> section will let you select
a report that matches some criteria.  For example, suppose that
you have report <code>A</code> that takes a parameter "fruit" with
values like "apple", "banana", and a report <code>B</code> that depends
on A.  You could then write:</p>
<pre>
<span class='no'>depends</span>:
  <span class='no'>A</span>:
    <span class='no'>id</span>: <span class='fu'>latest</span>(<span class='no'>parameter</span>:<span class='no'>fruit</span> <span class='kw'>==</span> <span class='st'>"apple"</span>)
    <span class='no'>uses</span>:
      <span class='no'>summary.csv</span>: <span class='no'>summary.csv</span></pre>

<p>To get the <code>summary.csv</code> file out of the latest report
<code>A</code> that was run with the "fruit" parameter set to "apple".
If "B" itself takes parameters, you can use those parameters in
these query expressions like</p>
<pre>
<span class='no'>depends</span>:
  <span class='no'>A</span>:
    <span class='no'>id</span>: <span class='fu'>latest</span>(<span class='no'>parameter</span>:<span class='no'>fruit</span> <span class='kw'>==</span> <span class='no'>target_fruit</span>)
    <span class='no'>uses</span>:
      <span class='no'>summary.csv</span>: <span class='no'>summary.csv</span></pre>

<p>(assuming that <code>B</code> takes a parameter <code>target_fruit</code>).</p>
<p>The syntax for tags is simpler, one uses <code>tag:tagname</code> to
test for presence of a tag called "tagname".</p>
<p>Search queries can be joined by <code>&amp;&amp;</code> and <code>||</code> and
grouped using parentheses, these groups (or tags) can be negated
with <code>!</code>, so a complicated query expression might look like:</p>
<pre>
(parameter:fruit == "apple" &amp;&amp; !tag:weekly) || parameter:fruit == "banana"
</pre>

<p>Be careful of comparing floating point numbers with <code>==</code> or
<code>!=</code> as they may not always return what you expect (for example
<code>sqrt(3)^2 == 3</code> is <code>FALSE</code>).</p>
<p>In the documentation and error messages we may refer to the
left-hand-side of <code>:</code> as a "namespace".  At this point the
only supported namespaces are <code>tag</code> and <code>parameter</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># We need a few reports here to actually query.  There is a report in</span>
<span class='co'># the "demo" example called "other" that takes a parameter "nmin",</span>
<span class='co'># which is used to filter data - it's not terribly important what it</span>
<span class='co'># does here, but it can give us a set of reports to use.</span>

<span class='co'># The demo set also includes configuration for two tags, called</span>
<span class='co'># "dataset" and "plot" - the "dataset" tag will always be applied</span>
<span class='co'># as it is listed in the orderly.yml but we can still add the</span>
<span class='co'># "plot" tag interactively</span>
<span class='no'>root</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'><a href='orderly_example.html'>orderly_example</a></span>(<span class='st'>"demo"</span>)

<span class='co'># A helper function to mass-produce reports will reduce noise a bit</span>
<span class='no'>run1</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>nmin</span>, <span class='no'>tags</span> <span class='kw'>=</span> <span class='kw'>NULL</span>) {
  <span class='no'>id</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='orderly_run.html'>orderly_run</a></span>(<span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>, <span class='kw'>echo</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
                    <span class='kw'>parameters</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>nmin</span> <span class='kw'>=</span> <span class='no'>nmin</span>), <span class='kw'>tags</span> <span class='kw'>=</span> <span class='no'>tags</span>)
  <span class='fu'><a href='orderly_commit.html'>orderly_commit</a></span>(<span class='no'>id</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)
  <span class='no'>id</span>
}

<span class='no'>ids</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'>run1</span>(<span class='fl'>0.1</span>), <span class='fu'>run1</span>(<span class='fl'>0.2</span>, <span class='st'>"plot"</span>), <span class='fu'>run1</span>(<span class='fl'>0.3</span>))</div><div class='output co'>#&gt; <span class='message'>[ name       ]  other</span></div><div class='output co'>#&gt; <span class='message'>[ id         ]  20200403-103547-db82d9bd</span></div><div class='output co'>#&gt; <span class='message'>[ sources    ]  functions.R</span></div><div class='output co'>#&gt; <span class='message'>[ parameter  ]  nmin: 0.1</span></div><div class='output co'>#&gt; <span class='message'>[ data       ]  source =&gt; extract: 19 x 2</span></div><div class='output co'>#&gt; <span class='message'>[ start      ]  2020-04-03 10:35:47</span></div><div class='output co'>#&gt; <span class='message'>[ end        ]  2020-04-03 10:35:47</span></div><div class='output co'>#&gt; <span class='message'>[ elapsed    ]  Ran report in 0.01186943 secs</span></div><div class='output co'>#&gt; <span class='message'>[ artefact   ]  summary.csv: da1bdb89343fc0c1c9b19f3d257d27f7</span>
#&gt; <span class='message'>[ ...        ]  graph.png: 0f5857002852d4d85f0d3423907eeb2c</span></div><div class='output co'>#&gt; <span class='message'>[ commit     ]  other/20200403-103547-db82d9bd</span></div><div class='output co'>#&gt; <span class='message'>[ copy       ]</span></div><div class='output co'>#&gt; <span class='message'>[ import     ]  other:20200403-103547-db82d9bd</span></div><div class='output co'>#&gt; <span class='message'>[ success    ]  :)</span></div><div class='output co'>#&gt; <span class='message'>[ name       ]  other</span></div><div class='output co'>#&gt; <span class='message'>[ id         ]  20200403-103548-1fd1b49c</span></div><div class='output co'>#&gt; <span class='message'>[ sources    ]  functions.R</span></div><div class='output co'>#&gt; <span class='message'>[ parameter  ]  nmin: 0.2</span></div><div class='output co'>#&gt; <span class='message'>[ data       ]  source =&gt; extract: 19 x 2</span></div><div class='output co'>#&gt; <span class='message'>[ start      ]  2020-04-03 10:35:48</span></div><div class='output co'>#&gt; <span class='message'>[ end        ]  2020-04-03 10:35:48</span></div><div class='output co'>#&gt; <span class='message'>[ elapsed    ]  Ran report in 0.01085401 secs</span></div><div class='output co'>#&gt; <span class='message'>[ artefact   ]  summary.csv: 8d5a99a3a15cb4d7225059854b331981</span>
#&gt; <span class='message'>[ ...        ]  graph.png: 0add2123b9b0e96c744f83678226bab3</span></div><div class='output co'>#&gt; <span class='message'>[ commit     ]  other/20200403-103548-1fd1b49c</span></div><div class='output co'>#&gt; <span class='message'>[ copy       ]</span></div><div class='output co'>#&gt; <span class='message'>[ import     ]  other:20200403-103548-1fd1b49c</span></div><div class='output co'>#&gt; <span class='message'>[ success    ]  :)</span></div><div class='output co'>#&gt; <span class='message'>[ name       ]  other</span></div><div class='output co'>#&gt; <span class='message'>[ id         ]  20200403-103548-4fe1b0ab</span></div><div class='output co'>#&gt; <span class='message'>[ sources    ]  functions.R</span></div><div class='output co'>#&gt; <span class='message'>[ parameter  ]  nmin: 0.3</span></div><div class='output co'>#&gt; <span class='message'>[ data       ]  source =&gt; extract: 17 x 2</span></div><div class='output co'>#&gt; <span class='message'>[ start      ]  2020-04-03 10:35:48</span></div><div class='output co'>#&gt; <span class='message'>[ end        ]  2020-04-03 10:35:48</span></div><div class='output co'>#&gt; <span class='message'>[ elapsed    ]  Ran report in 0.01071358 secs</span></div><div class='output co'>#&gt; <span class='message'>[ artefact   ]  summary.csv: 2e7846ef0c35253edf73a8380443fa4a</span>
#&gt; <span class='message'>[ ...        ]  graph.png: 5a377d59d4b20772ac61b7a407cc0a0c</span></div><div class='output co'>#&gt; <span class='message'>[ commit     ]  other/20200403-103548-4fe1b0ab</span></div><div class='output co'>#&gt; <span class='message'>[ copy       ]</span></div><div class='output co'>#&gt; <span class='message'>[ import     ]  other:20200403-103548-4fe1b0ab</span></div><div class='output co'>#&gt; <span class='message'>[ success    ]  :)</span></div><div class='input'>
<span class='co'># We can then ask for all reports where the parameter nmin was more</span>
<span class='co'># than some value</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"parameter:nmin &gt; 0.15"</span>, <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; [1] "20200403-103548-1fd1b49c" "20200403-103548-4fe1b0ab"</div><div class='input'>
<span class='co'># Or use "&amp;&amp;" to find tags within a range</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"parameter:nmin &gt; 0.1 &amp;&amp; parameter:nmin &lt; 0.3"</span>,
                        <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; [1] "20200403-103548-1fd1b49c"</div><div class='input'>
<span class='co'># If a parameter is not present in some versions of a report you</span>
<span class='co'># can use is.null to test for it (this is only ever the case if</span>
<span class='co'># you have altered a report definition to add or remove a</span>
<span class='co'># parameter)</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"is.null(parameter:nmin)"</span>, <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; character(0)</div><div class='input'>
<span class='co'># We can look for tags</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"tag:plot"</span>, <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; [1] "20200403-103548-1fd1b49c"</div><div class='input'>
<span class='co'># or exclude them</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"!tag:plot"</span>, <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; [1] "20200403-103547-db82d9bd" "20200403-103548-4fe1b0ab"</div><div class='input'>
<span class='co'># or combine that with the presence/absence of a tag</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"parameter:nmin &gt; 0.15 &amp;&amp; !tag:plot"</span>,
                        <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; [1] "20200403-103548-4fe1b0ab"</div><div class='input'>
<span class='co'># Use latest() over a query to find the latest report matching the</span>
<span class='co'># query expression.</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"latest(parameter:nmin &gt; 0.15)"</span>,
                        <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; [1] "20200403-103548-4fe1b0ab"</div><div class='input'>
<span class='co'># If no reports are found, then a zero-length character vector is returned</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"parameter:nmin &gt; 0.4"</span>, <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; character(0)</div><div class='input'>
<span class='co'># Or, in the case of latest(), NA</span>
<span class='kw pkg'>orderly</span><span class='kw ns'>::</span><span class='fu'>orderly_search</span>(<span class='st'>"latest(parameter:nmin &gt; 0.4)"</span>,
                        <span class='st'>"other"</span>, <span class='kw'>root</span> <span class='kw'>=</span> <span class='no'>root</span>)</div><div class='output co'>#&gt; [1] NA</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill, Martin Eden, Wes Hinsley, Emma Russell, James Thompson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


